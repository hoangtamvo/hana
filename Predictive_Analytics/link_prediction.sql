CREATE SCHEMA DM_PAL;

SET SCHEMA DM_PAL;

DROP TYPE PAL_LINK_PREDICTION_DATA_T;
CREATE TYPE PAL_LINK_PREDICTION_DATA_T AS TABLE(
"NODE1" INTEGER,
"NODE2" INTEGER
);

DROP TYPE PAL_CONTROL_T;
CREATE TYPE PAL_CONTROL_T AS TABLE(
"NAME" VARCHAR(100), "INTARGS" INTEGER,
"DOUBLEARGS" DOUBLE,
"STRINGARGS" VARCHAR(100)
);

DROP TYPE PAL_LINK_PREDICTION_RESULT_T;
CREATE TYPE PAL_LINK_PREDICTION_RESULT_T AS TABLE(
"NODE1" INTEGER,
"NODE2" INTEGER,
"SCORE" DOUBLE
);


DROP TABLE PAL_LINK_PREDICTION_PDATA_TBL;
CREATE COLUMN TABLE PAL_LINK_PREDICTION_PDATA_TBL(
 "POSITION" INTEGER,
 "SCHEMA_NAME" VARCHAR(100),
 "TYPE_NAME" VARCHAR(100),
 "PARAMETER_TYPE" VARCHAR(100)
);
INSERT INTO PAL_LINK_PREDICTION_PDATA_TBL VALUES (1, 'DM_PAL',
'PAL_LINK_PREDICTION_DATA_T', 'in');
INSERT INTO PAL_LINK_PREDICTION_PDATA_TBL VALUES (2, 'DM_PAL', 'PAL_CONTROL_T',
'in');
INSERT INTO PAL_LINK_PREDICTION_PDATA_TBL VALUES (3, 'DM_PAL',
'PAL_LINK_PREDICTION_RESULT_T', 'out');

CALL SYS.AFLLANG_WRAPPER_PROCEDURE_DROP('DM_PAL', 'PAL_LINK_PREDICTION_PROC');
CALL SYS.AFLLANG_WRAPPER_PROCEDURE_CREATE('AFLPAL', 'LINKPREDICTION', 'DM_PAL', 'PAL_LINK_PREDICTION_PROC', PAL_LINK_PREDICTION_PDATA_TBL);

DROP TABLE #PAL_CONTROL_TBL;
CREATE LOCAL TEMPORARY COLUMN TABLE #PAL_CONTROL_TBL (
"NAME" VARCHAR (100),
"INTARGS" INTEGER,
"DOUBLEARGS" DOUBLE,
"STRINGARGS" VARCHAR (100)
);

INSERT INTO #PAL_CONTROL_TBL VALUES ('METHOD', 1, NULL, NULL);

DROP TABLE PAL_LINK_PREDICTION_DATA_TBL;
CREATE COLUMN TABLE PAL_LINK_PREDICTION_DATA_TBL LIKE PAL_LINK_PREDICTION_DATA_T;
INSERT INTO PAL_LINK_PREDICTION_DATA_TBL VALUES ('1','2');
INSERT INTO PAL_LINK_PREDICTION_DATA_TBL VALUES ('1','4');
INSERT INTO PAL_LINK_PREDICTION_DATA_TBL VALUES ('2','3');
INSERT INTO PAL_LINK_PREDICTION_DATA_TBL VALUES ('3','4');
INSERT INTO PAL_LINK_PREDICTION_DATA_TBL VALUES ('5','1');
INSERT INTO PAL_LINK_PREDICTION_DATA_TBL VALUES ('6','2');
INSERT INTO PAL_LINK_PREDICTION_DATA_TBL VALUES ('7','4');
INSERT INTO PAL_LINK_PREDICTION_DATA_TBL VALUES ('7','5');
INSERT INTO PAL_LINK_PREDICTION_DATA_TBL VALUES ('6','7');
INSERT INTO PAL_LINK_PREDICTION_DATA_TBL VALUES ('5','4');

DROP TABLE PAL_LINK_PREDICTION_RESULT_TBL;
CREATE COLUMN TABLE PAL_LINK_PREDICTION_RESULT_TBL LIKE PAL_LINK_PREDICTION_RESULT_T;

CALL DM_PAL.PAL_LINK_PREDICTION_PROC(PAL_LINK_PREDICTION_DATA_TBL, #PAL_CONTROL_TBL, PAL_LINK_PREDICTION_RESULT_TBL) WITH OVERVIEW;

SELECT * FROM PAL_LINK_PREDICTION_RESULT_TBL ORDER BY NODE1, NODE2;


